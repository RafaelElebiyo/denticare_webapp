{% extends 'baseAuth.html.twig' %}

{% block title %}Changer Mot de Pass{% endblock %}

{% block body %}
<script>
    function cambiarTipo(tipo, myinput) {
        myinput.type = tipo;
    }

    function comprobarar_contrasenas() {
        pass1 = document.getElementById('password1').value;
        pass2 = document.getElementById('mdp_form_plainPassword').value;
        pass3 = document.getElementById('password3').value;
        result = pass2 != pass3 ? 'Verifiez la confirmation du mot de passe' : '';
        result = pass1 == pass2 ? 'Ne reutilisez pas la meme mot de passe' : result;
        document.getElementById('resultado').innerHTML = result;
        if(result != '') return false;

        var xhr = new XMLHttpRequest();

        xhr.open('POST', "{{ path('compare_password') }}", true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

        xhr.onreadystatechange = function() {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText)
                    if(response.mensaje == '1') {
                        document.getElementById('formmdp').submit();
                    }
                    else document.getElementById('resultado').innerHTML = 'Mot de pass actuel invalide';
                } else {
                    document.getElementById('resultado').innerHTML = '<p>Erreur!!!</p>';
                }
            }
        };
        var params = 'password=' + encodeURIComponent(pass1);
        xhr.send(params);

        return false;
    }
</script>


<div class="container-fluid banner mb-5">
    <div class="container" style="margin-top: 120px; margin-bottom: 100px;">
        <div class="row gx-0 justify-content-center">
            <div class="bg-dark d-flex flex-column p-5" style="height: auto; width:500px;">
                <form id="formmdp" method="post" onsubmit="return comprobarar_contrasenas()">
                    <div class="mb-3">
                        <label for="password1">Mot de pass actuel</label>
                        <input type="password" onmouseup="cambiarTipo('text',this);"
                            onmouseout="cambiarTipo('password',this);" name="password1" id="password1"
                            class="form-control" autocomplete="current-password" required>
                    </div>
                    <div class="mb-3">
                        <label for="mdp_form_plainPassword">Nouvelle mot de passe</label>   
                        {{ form_widget(form.plainPassword, {'attr': {'class': 'form-control', 'onmouseup':'cambiarTipo("text",this)','onmouseout':'cambiarTipo("password",this)', 'pattern': '(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z]).{8,12}'}}) }}
                    </div>
                    <div class="mb-3">
                        <label for="password3">Repeter mot de pass</label>
                        <input type="password" onmouseup="cambiarTipo('text',this);"
                            onmouseout="cambiarTipo('password',this);" name="password3" id="password3"
                            class="form-control" autocomplete="current-password" required>
                        <p id="resultado" class="text-danger mb-0">&nbsp;</p>
                    </div>
                    <div style="display:none;">
                        {{ form_row(form) }}
                    </div>  
                    <center><button class="btn btn-lg btn-primary mt-1" type="sumbit">Confirmer</button></center>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}